name: å¾®åšçƒ­æœäº§å“åˆ›æ„åˆ†æï¼ˆDeepSeek å…è´¹ç‰ˆï¼‰

on:
  # å®šæ—¶æ‰§è¡Œï¼šæ¯å¤©æ—©ä¸Š 9:15 (UTC+8 = UTC 01:15) - é¿å¼€æ•´ç‚¹é«˜å³°
  schedule:
    - cron: '15 1 * * *'  # æ”¹ä¸º 01:15 UTCï¼Œé¿å…å»¶è¿Ÿ
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      max_hotspots:
        description: 'åˆ†æçƒ­æœæ•°é‡'
        required: false
        default: '3'  # é»˜è®¤æ”¹ä¸º 3 æ¡
      ai_model:
        description: 'AI æ¨¡å‹'
        required: false
        default: 'gpt-4o'
        type: choice
        options:
          - gpt-4o
          - gpt-4o-mini
          - deepseek-r1
          - llama-3-70b

jobs:
  analyze:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    permissions:
      contents: write
    
    steps:
      - name: ğŸ“¥ Checkout ä»£ç 
        uses: actions/checkout@v4
      
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci
      
      - name: ğŸ¤– æ‰§è¡Œåˆ†æä»»åŠ¡ï¼ˆDeepSeek APIï¼‰
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # è‡ªåŠ¨æä¾›ï¼Œæ— éœ€é…ç½®
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}  # DeepSeek å…è´¹ API
          WEIBO_API_URL: ${{ secrets.WEIBO_API_URL }}
          WEIBO_API_HEADERS: ${{ secrets.WEIBO_API_HEADERS }}
          MAX_HOTSPOTS: ${{ github.event.inputs.max_hotspots || '3' }}  # é»˜è®¤æ”¹ä¸º 3
          AI_MODEL: ${{ github.event.inputs.ai_model || 'gpt-4o' }}
        run: npm run analyze
      
      - name: ğŸ“¤ ä¸Šä¼  HTML æŠ¥å‘Š
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: weibo-hotspot-report-${{ github.run_number }}
          path: weibo_hotspot_analysis_*.html
          retention-days: 30
      
      - name: ğŸ“Š æäº¤æŠ¥å‘Šåˆ°ä»“åº“ï¼ˆå¯é€‰ï¼‰
        if: success()
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git add weibo_hotspot_analysis_*.html || true
          git commit -m "ğŸ“Š è‡ªåŠ¨ç”Ÿæˆå¾®åšçƒ­æœåˆ†ææŠ¥å‘Š - $(date +'%Y-%m-%d %H:%M')" || echo "No changes to commit"
          git push || echo "Push failed, continuing..."
